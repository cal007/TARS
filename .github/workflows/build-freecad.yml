name: build-freecad
on:
  workflow_dispatch:
  push:
    paths:
      - '01_CAD/src/**.py'
      - '.github/workflows/build-freecad.yml'
      - '03_Docs/**'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Fetch FreeCAD 1.0 AppImage
        run: |
          FC_VER="1.0"
          # Download offizielles AppImage (Stable). URL ggf. anpassen, falls Release-Name sich ändert.
          wget -O FreeCAD.AppImage https://github.com/FreeCAD/FreeCAD/releases/download/1.0.0/FreeCAD_1.0.0-Linux-x86_64.AppImage
          chmod +x FreeCAD.AppImage
          # Entpacken, damit wir FreeCADCmd direkt aufrufen können (stabiler in CI)
          ./FreeCAD.AppImage --appimage-extract
          echo "$PWD/squashfs-root/usr/bin" >> $GITHUB_PATH

      - name: Build FCStd and STEP (FreeCADCmd)
        run: |
          mkdir -p 01_CAD/build
          FreeCADCmd -c 01_CAD/src/build_tars_fcstd.py

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: TARS_v0.2_FCStd_STEP
          path: |
            01_CAD/build/TARS_v0.2.FCStd
            01_CAD/build/TARS_v0.2.step
          if-no-files-found: error
